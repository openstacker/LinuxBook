# 基础工具

---

Gathing指的是性能调优之前的信息收集，通常需要收集从硬件基础设施到操作系统以及应用相关的内容，用来作为之后性能分析和调优的数据基础。

## 硬件相关

### dmesg

dmesg命令将会显示本次开机之后所有的内核ring缓冲区的内容，当系统启动后，这部分的内容将包括内核加载所有硬件设备的初始化信息，同时相关内容也会被以文件形式保存在/var/log/dmesg中。我们使用这条命令主要是为了检测是否出现了CPU、内存以及热拔插设备的问题。

* 注意由于日志级别较低，所以显示内容较多，通常应配合其他工具使用。

### lspci

显示所有的PCI设备。当我们无法确定硬件设备上的具体设备型号以及规格的时候，通常使用这条命令。如使用lspci \| grep Ethernet可以显示出设备上挂载的网卡信息，-v参数可以显示更为详细的内容。

### dmidecode

当我们只能远程到某台服务器而无法登陆其IPMI管理界面的时候，这条命令可以为我们提供详细的硬件信息。携带参数-t可以输出指定类型的设备信息。

### /proc

/proc下保存了系统内核在运行状态中的所有数据，我们可以从这里拿到相关的内核参数或者对其进行修改，/proc是一个伪文件系统，只存在于内存之中。在分析和调优的过程中，这里的内容通常是我们最多针对的地方。

## 常用软件

### vmstat

常用工具之一，可以显示系统进程、内存、页处理、磁盘IO以及CPU活动状态的信息。

结果的第一列显示了可执行但未执行的进程，这列参数的含义基本表明了系统cpu调度的繁忙程度，如果此结果持续增加说明服务器的CPU资源较为紧张。  
结果的第二列则表示被block的进程，如果此列较高说明服务器的IO出现了问题导致大量进程被阻塞。

### sar

sar是sysstat工具包中的一个工具，可以用来收集系统活动状态并生成结果，此工具非常强大，建议熟练掌握，具体内容参考[命令详解](http://www.chinaz.com/server/2013/0401/297942.shtml)。

### 其他

top、dstat等也作为辅助工具被经常使用。

### Benchmarking工具

通常我们需要一部分工具得到系统中某些设备的基础性能以确认不是底层硬件出现了性能问题，我们在日常工作中比较常用的工具包括iPerf和fio。

iPerf可以为我们提供两台计算机之间的网络吞吐，支持tcp和udp协议，使用方法比较简单，服务器端使用参数-s，客户端使用参数-c并且指定服务器端地址即可。

fio的使用较为复杂，而且不同的参数带来的结果会有很大差异，建议使用时参考[公司文档](https://www.ustack.com/blog/how-benchmark-ebs/)。



