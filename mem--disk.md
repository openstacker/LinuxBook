# 内存及磁盘相关

---

## 内存相关

内存是影响Linux性能的主要因素之一，通常出现的问题都与内存资源是否充足有关。

在Linux操作系统中，所以空余内存空间可以认为是free内存+buffer内存+cache内存，当内存不够的时候，则需要将内存中的数据换出到磁盘上的swap区域中，而内存的换入换出则意味着大量的磁盘IO调用。按照经验数据，当空余内存小于20%的时候，将会出频繁的内存换入换出，此时整个系统的性能将会急剧下降，很多服务和应用的响应时间会被拉长，甚至出现OOM而杀死进程的情况。如果出现类似的情况则明显需要增加内存。

同时每个进程可使用的内存大小也是可以配置的，这样我们就可以防止出现某些异常的进程大量占用内存不进行释放而带来内存不足的问题，配置文件位于/etc/security/limits.conf，如下的内容将会限制用户bob的进程仅可以使用15KB内存，用户组alice的进程只能使用20KB内存：

```shell
$ cat /etc/security/limits.conf
...
bob    hard    rss    15000
@alice hard    rss    20000
```

用户可以使用ulimit -a来查看自己的限制。

### OOM

当出现了内存不足的情况下，可能会导致OOM的情况，OOM是out of memory的缩写，虽然linux kernel有很多的内存管理技巧来满足各种应用空间的内存需求，但是当系统配置不合理的时候，linux kernel会运行非常缓慢并且在某个时间点分配page frame的时候遇到内存耗尽、无法分配的状况，此时系统会有两种处理情况：

1. 产生kernel panic
2. 选择几个最“适合”的进程，启用oom-killer，释放内存

sysctl\_panic\_on\_oom内核参数的配置就是针对这种情况下两种不同的动作而存在的，动态路径为/proc/sys/vm/panic\_on\_oom。

如果选择第二种方式，那么就引入了一个新的问题，

