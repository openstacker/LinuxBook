# HA基础知识

---

##衡量指标

HA集群的主要目标只有一个，那就是通过消除瓶颈与单点故障以最大程度保证服务的可用。这一点与保证某一台单独服务器的最长在线时间是不尽相同的，客户端对服务的访问并不关心承载其访问服务的服务器本身的在线时间，关心的是服务本身。业界通常用N个9用来表示服务的可用性等级，其含义为服务本身的可用时间占比为小数点后几个9。

高可用集群在节点故障时，通过将其承载服务迁移到另一个节点上以保证服务本身的可用，这一过程称为故障切换（failover）。在故障切换的时候通常会有两个指标作为参考，分别为RTO故障恢复目标与RPO恢复点目标，分别表示从故障中恢复所需的时间和故障恢复后所恢复的数据时间节点。不同的服务队RTO和RPO的需求程度也不尽相同。

##种类

Active/Passive HA：集群只包括两个节点简称主备。在这种配置下，系统采用主和备用机器来提供服务，系统只在主设备上提供服务。在主设备故障时，备设备上的服务被启动来替代主设备提供的服务。典型地，比如 Pacemaker 来控制主备设备之间的切换，并提供一个虚机 IP 来提供服务。

Active/Active HA：集群只包括两个节点时简称双活，包括多节点时成为多主（Multi-master）。在这种配置下，系统在集群内所有服务器上运行同样的负载。这种配置下往往采用负载均衡软件比如 HAProxy 来提供服务的虚拟 IP。

##常见架构

针对服务集群的高可用架构较为标准，通常表现多台集群节点，节点至少分享两张互联网络，分别作为服务提供网络与集群通信网络；同时如果涉及数据同步，所有节点之间可能会存在存储网络，无论是依靠分布式存储或传统商业存储的方式。

同时针对节点的硬件特性也需要提供各个维度的冗余，比如电源、磁盘以及网卡等。

除了节点之外，通常在高可用架构中需要网络的配合，比如VRRP、链路捆绑以及负载均衡等。